<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard | LevelUp Academy</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    /* Override with admin-specific colors while using new system */
    :root {
      --bg: var(--lu-bg);
      --card: var(--lu-surface);
      --accent: var(--lu-primary-light);
      --accent-2: var(--lu-accent);
      --text: var(--lu-text-primary);
      --muted: var(--lu-text-muted);
      --success: var(--lu-success);
      --error: var(--lu-danger);
      --warning: var(--lu-warning);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Space Grotesk', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, var(--lu-secondary-dark) 0%, var(--lu-bg) 50%, var(--lu-secondary-dark) 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .container {
      flex: 1;
    }
    
    /* Header */
    .header {
      background: var(--lu-bg);
      border-bottom: 1px solid var(--lu-border-subtle);
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }
    .logo {
      font-size: 20px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .user-name {
      color: var(--muted);
      font-size: 14px;
    }
    .user-name strong {
      color: var(--text);
    }
    .role-badge {
      padding: 6px 12px;
      background: rgba(168,85,247,0.2);
      border: 1px solid rgba(168,85,247,0.3);
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      color: var(--accent-2);
    }
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--text);
      text-decoration: none;
      display: inline-block;
    }
    .btn:hover {
      background: rgba(255,255,255,0.08);
      transform: translateY(-1px);
    }
    
    /* Container */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }
    
    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }
    .stat-card {
      background: var(--lu-surface), rgba(255,255,255,0.04));
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 16px;
      padding: 24px;
      position: relative;
      overflow: hidden;
    }
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, rgba(34,211,238,0.1), transparent);
      border-radius: 50%;
      transform: translate(30%, -30%);
    }
    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }
    .stat-icon {
      font-size: 32px;
    }
    .stat-value {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 4px;
      background: var(--lu-gradient-brand);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .stat-label {
      color: var(--muted);
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      overflow-x: auto;
      padding-bottom: 2px;
    }
    .tab {
      padding: 12px 24px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      color: var(--muted);
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
      position: relative;
    }
    .tab:hover {
      color: var(--text);
      background: rgba(255,255,255,0.02);
    }
    .tab.active {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }
    .tab-badge {
      display: inline-block;
      margin-left: 8px;
      padding: 2px 8px;
      background: rgba(251,191,36,0.2);
      border-radius: 10px;
      font-size: 11px;
      color: var(--warning);
    }
    
    /* Table */
    .table-container {
      background: var(--lu-surface), rgba(255,255,255,0.04));
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 24px;
    }
    .table-header {
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .table-title {
      font-size: 18px;
      font-weight: 600;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th {
      background: rgba(255,255,255,0.02);
      padding: 16px;
      text-align: left;
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    td {
      padding: 16px;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      font-size: 14px;
    }
    tr:last-child td {
      border-bottom: none;
    }
    tr:hover {
      background: rgba(255,255,255,0.02);
    }
    
    /* Status Badge */
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .status-pending {
      background: rgba(251,191,36,0.2);
      color: var(--warning);
      border: 1px solid rgba(251,191,36,0.3);
    }
    .status-approved {
      background: rgba(74,222,128,0.2);
      color: var(--success);
      border: 1px solid rgba(74,222,128,0.3);
    }
    
    /* Badge styles for subscriptions */
    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .badge-basic {
      background: rgba(34,211,238,0.2);
      color: var(--accent);
      border: 1px solid rgba(34,211,238,0.3);
    }
    .badge-standard {
      background: rgba(168,85,247,0.2);
      color: #a855f7;
      border: 1px solid rgba(168,85,247,0.3);
    }
    .badge-premium {
      background: rgba(251,191,36,0.2);
      color: var(--warning);
      border: 1px solid rgba(251,191,36,0.3);
    }
    .badge-active {
      background: rgba(74,222,128,0.2);
      color: var(--success);
      border: 1px solid rgba(74,222,128,0.3);
    }
    .badge-pending {
      background: rgba(251,191,36,0.2);
      color: var(--warning);
      border: 1px solid rgba(251,191,36,0.3);
    }
    
    .table-subtitle {
      font-size: 13px;
      color: var(--muted);
      margin-top: 4px;
    }
    
    /* Filters */
    .filter-btn {
      padding: 8px 16px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: var(--muted);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .filter-btn:hover {
      background: rgba(255,255,255,0.1);
      color: var(--text);
    }
    .filter-btn.active {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      border-color: var(--accent);
      color: white;
    }
    
    /* Row highlighting */
    .row-no-subscription {
      opacity: 0.7;
    }
    .row-unpaid {
      border-left: 3px solid var(--warning);
    }
    .row-active-paid {
      border-left: 3px solid var(--success);
    }
    
    /* Modal styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .modal {
      background: linear-gradient(145deg, rgba(20,20,30,0.95), rgba(15,15,25,0.95));
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }
    .modal-header {
      padding: 24px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-title {
      font-size: 20px;
      font-weight: 600;
    }
    .modal-close {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    .modal-close:hover {
      background: rgba(255,255,255,0.1);
      color: var(--text);
    }
    .modal-body {
      padding: 24px;
    }
    .modal-section {
      margin-bottom: 32px;
    }
    .modal-section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--accent);
    }
    
    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
      border-radius: 6px;
      border: 1px solid;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 600;
    }
    .btn-approve {
      background: rgba(74,222,128,0.15);
      border-color: rgba(74,222,128,0.3);
      color: var(--success);
    }
    .btn-approve:hover {
      background: rgba(74,222,128,0.25);
    }
    .btn-reject {
      background: rgba(248,113,113,0.15);
      border-color: rgba(248,113,113,0.3);
      color: var(--error);
    }
    .btn-reject:hover {
      background: rgba(248,113,113,0.25);
    }
    .btn-view {
      background: rgba(34,211,238,0.15);
      border-color: rgba(34,211,238,0.3);
      color: var(--accent);
    }
    .btn-view:hover {
      background: rgba(34,211,238,0.25);
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }
    .empty-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.3;
    }
    
    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--muted);
    }
    .spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid rgba(34,211,238,0.2);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
      border: 1px solid;
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      transform: translateX(400px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
      max-width: 400px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }
    .toast.success {
      border-color: var(--success);
    }
    .toast.error {
      border-color: var(--error);
    }
    .toast-icon {
      font-size: 24px;
    }
    
    @media (max-width: 768px) {
      .table-container {
        overflow-x: auto;
      }
      table {
        min-width: 700px;
      }
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      .header-right {
        flex-direction: column;
        align-items: flex-end;
        gap: 8px;
      }
    }
  </style>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
  <body>
    <div id="app">
    <!-- Header -->
    <div class="header lu-header" style="position: sticky; top: 0; z-index: 100;">
      <a href="home.html" class="lu-logo-link" style="text-decoration: none;">
        <img src="/assets/logo/logo.png" alt="LevelUp Academy" class="lu-logo-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';" style="height: 40px !important; width: auto !important; max-width: 180px !important; min-width: 120px !important; display: block !important; visibility: visible !important; opacity: 1 !important;">
        <span class="logo" style="display:none;">üéÆ LevelUp Academy - Admin Panel</span>
      </a>
      <div class="header-right">
        <a href="add-training-class.html" class="btn" style="background: var(--lu-gradient-brand); color: #111827; border: none;">+ Add Class</a>
        <span class="user-name">Welcome, <strong style="color: var(--lu-accent);">{{ userName }}</strong></span>
        <span class="role-badge" style="background: rgba(255, 200, 87, 0.2); border-color: rgba(255, 200, 87, 0.3); color: var(--lu-accent);">ADMIN</span>
        <button class="btn" @click="logout">Logout</button>
      </div>
    </div>

    <!-- Main Container -->
    <div class="container">
      <!-- Overview Stats -->
      <div v-if="overviewStats" class="stats-grid" style="margin-bottom: 32px;">
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">üí∞</div>
          </div>
          <div class="stat-value">{{ overviewStats.totalRevenue?.toLocaleString() || 0 }}</div>
          <div class="stat-label">Total Revenue ({{ overviewStats.currency }})</div>
        </div>
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">üí≥</div>
          </div>
          <div class="stat-value">{{ overviewStats.activeSubscriptions || 0 }}</div>
          <div class="stat-label">Active Subscriptions</div>
        </div>
      </div>

      <!-- Statistics -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">‚è≥</div>
          </div>
          <div class="stat-value">{{ stats.pendingPros }}</div>
          <div class="stat-label">Pending Pro Players</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">‚è≥</div>
          </div>
          <div class="stat-value">{{ stats.pendingTrainers }}</div>
          <div class="stat-label">Pending Trainers</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">‚úÖ</div>
          </div>
          <div class="stat-value">{{ stats.approvedPros }}</div>
          <div class="stat-label">Approved Pros</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">‚úÖ</div>
          </div>
          <div class="stat-value">{{ stats.approvedTrainers }}</div>
          <div class="stat-label">Approved Trainers</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">üéÆ</div>
          </div>
          <div class="stat-value">{{ stats.totalPlayers }}</div>
          <div class="stat-label">Total Players</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon">üë®‚Äçüë©‚Äçüëß</div>
          </div>
          <div class="stat-value">{{ stats.totalParents }}</div>
          <div class="stat-label">Total Parents</div>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab" :class="{ active: activeTab === 'pending' }" @click="activeTab = 'pending'">
          üîî Pending Approvals
          <span class="tab-badge" v-if="stats.pendingPros + stats.pendingTrainers > 0">
            {{ stats.pendingPros + stats.pendingTrainers }}
          </span>
        </button>
        <button class="tab" :class="{ active: activeTab === 'pros' }" @click="activeTab = 'pros'">
          ‚≠ê All Pro Players
        </button>
        <button class="tab" :class="{ active: activeTab === 'trainers' }" @click="activeTab = 'trainers'">
          üéì All Trainers
        </button>
        <button class="tab" :class="{ active: activeTab === 'players' }" @click="activeTab = 'players'">
          üéÆ All Players
        </button>
        <button class="tab" :class="{ active: activeTab === 'parents' }" @click="activeTab = 'parents'">
          üë®‚Äçüë©‚Äçüëß All Parents
        </button>
        <button class="tab" :class="{ active: activeTab === 'subscriptions' }" @click="activeTab = 'subscriptions'">
          üí≥ Subscriptions
        </button>
        <button class="tab" :class="{ active: activeTab === 'bookings' }" @click="activeTab = 'bookings'">
          üìÖ Payments & Bookings
        </button>
      </div>

      <!-- Pending Approvals Tab -->
      <div v-if="activeTab === 'pending'">
        <!-- Pending Pro Players -->
        <div class="table-container" v-if="pendingPros.length > 0">
          <div class="table-header">
            <div class="table-title">‚è≥ Pending Pro Player Applications</div>
          </div>
          <div v-if="loading" class="loading">
            <div class="spinner"></div>
          </div>
          <table v-else>
            <thead>
              <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>CV</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="pro in pendingPros" :key="pro.id">
                <td>{{ pro.id }}</td>
                <td><strong>{{ pro.user.username }}</strong></td>
                <td>{{ pro.user.firstName }} {{ pro.user.lastName }}</td>
                <td>{{ pro.user.email }}</td>
                <td>{{ pro.phoneNumber || 'N/A' }}</td>
                <td>
                  <button class="btn-sm btn-view" @click="downloadCV('pro', pro.id)">
                    üìÑ View
                  </button>
                </td>
                <td>
                  <div class="action-buttons">
                    <button class="btn-sm btn-approve" @click="approvePro(pro.id)" :disabled="processing">
                      ‚úì Approve
                    </button>
                    <button class="btn-sm btn-reject" @click="rejectPro(pro.id)" :disabled="processing">
                      ‚úó Reject
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pending Trainers -->
        <div class="table-container" v-if="pendingTrainers.length > 0">
          <div class="table-header">
            <div class="table-title">‚è≥ Pending Trainer Applications</div>
          </div>
          <div v-if="loading" class="loading">
            <div class="spinner"></div>
          </div>
          <table v-else>
            <thead>
              <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Name</th>
                <th>Email</th>
                <th>CV</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="trainer in pendingTrainers" :key="trainer.id">
                <td>{{ trainer.id }}</td>
                <td><strong>{{ trainer.user.username }}</strong></td>
                <td>{{ trainer.user.firstName }} {{ trainer.user.lastName }}</td>
                <td>{{ trainer.user.email }}</td>
                <td>
                  <button class="btn-sm btn-view" @click="downloadCV('trainer', trainer.id)">
                    üìÑ View
                  </button>
                </td>
                <td>
                  <div class="action-buttons">
                    <button class="btn-sm btn-approve" @click="approveTrainer(trainer.id)" :disabled="processing">
                      ‚úì Approve
                    </button>
                    <button class="btn-sm btn-reject" @click="rejectTrainer(trainer.id)" :disabled="processing">
                      ‚úó Reject
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- No Pending -->
        <div v-if="pendingPros.length === 0 && pendingTrainers.length === 0" class="empty-state">
          <div class="empty-icon">‚úÖ</div>
          <div style="font-size: 18px; margin-bottom: 8px;">All Caught Up!</div>
          <div>No pending approval requests at the moment.</div>
        </div>
      </div>

      <!-- Pro Players Tab -->
      <div v-if="activeTab === 'pros'" class="table-container">
        <div class="table-header">
          <div class="table-title">‚≠ê All Pro Players</div>
        </div>
        <div v-if="loading" class="loading"><div class="spinner"></div></div>
        <div v-else-if="pros.length === 0" class="empty-state">
          <div class="empty-icon">‚≠ê</div>
          <div>No pro players registered yet</div>
        </div>
        <table v-else>
          <thead>
            <tr>
              <th>ID</th>
              <th>Username</th>
              <th>Name</th>
              <th>Email</th>
              <th>Status</th>
              <th>CV</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="pro in pros" :key="pro.id">
              <td>{{ pro.id }}</td>
              <td><strong>{{ pro.user.username }}</strong></td>
              <td>{{ pro.user.firstName }} {{ pro.user.lastName }}</td>
              <td>{{ pro.user.email }}</td>
              <td>
                <span class="status-badge" :class="pro.isApproved ? 'status-approved' : 'status-pending'">
                  {{ pro.isApproved ? '‚úì Approved' : '‚è≥ Pending' }}
                </span>
              </td>
              <td>
                <button class="btn-sm btn-view" @click="downloadCV('pro', pro.id)">
                  üìÑ View
                </button>
              </td>
              <td>
                <div class="action-buttons">
                  <button v-if="!pro.isApproved" class="btn-sm btn-approve" @click="approvePro(pro.id)">‚úì</button>
                  <button v-if="!pro.isApproved" class="btn-sm btn-reject" @click="rejectPro(pro.id)">‚úó</button>
                  <button class="btn-sm btn-view" @click="editUser(pro.user?.id)" style="margin-left: 4px;">‚úèÔ∏è</button>
                  <button class="btn-sm btn-reject" @click="deleteUser(pro.user?.id)" style="margin-left: 4px;">üóëÔ∏è</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Trainers Tab -->
      <div v-if="activeTab === 'trainers'" class="table-container">
        <div class="table-header">
          <div class="table-title">üéì All Trainers</div>
        </div>
        <div v-if="loading" class="loading"><div class="spinner"></div></div>
        <div v-else-if="trainers.length === 0" class="empty-state">
          <div class="empty-icon">üéì</div>
          <div>No trainers registered yet</div>
        </div>
        <table v-else>
          <thead>
            <tr>
              <th>ID</th>
              <th>Username</th>
              <th>Name</th>
              <th>Email</th>
              <th>Status</th>
              <th>CV</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="trainer in trainers" :key="trainer.id">
              <td>{{ trainer.id }}</td>
              <td><strong>{{ trainer.user.username }}</strong></td>
              <td>{{ trainer.user.firstName }} {{ trainer.user.lastName }}</td>
              <td>{{ trainer.user.email }}</td>
              <td>
                <span class="status-badge" :class="trainer.isApproved ? 'status-approved' : 'status-pending'">
                  {{ trainer.isApproved ? '‚úì Approved' : '‚è≥ Pending' }}
                </span>
              </td>
              <td>
                <button class="btn-sm btn-view" @click="downloadCV('trainer', trainer.id)">
                  üìÑ View
                </button>
              </td>
              <td>
                <div class="action-buttons">
                  <button v-if="!trainer.isApproved" class="btn-sm btn-approve" @click="approveTrainer(trainer.id)">‚úì</button>
                  <button v-if="!trainer.isApproved" class="btn-sm btn-reject" @click="rejectTrainer(trainer.id)">‚úó</button>
                  <button class="btn-sm btn-view" @click="editUser(trainer.user?.id)" style="margin-left: 4px;">‚úèÔ∏è</button>
                  <button class="btn-sm btn-reject" @click="deleteUser(trainer.user?.id)" style="margin-left: 4px;">üóëÔ∏è</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Players Tab -->
      <div v-if="activeTab === 'players'" class="table-container">
        <div class="table-header">
          <div>
            <div class="table-title">üéÆ All Players</div>
            <div class="table-subtitle">View players with subscription and payment status</div>
          </div>
        </div>
        
        <!-- Filters -->
        <div class="filters" style="padding: 16px 24px; border-bottom: 1px solid rgba(255,255,255,0.06); display: flex; gap: 12px; flex-wrap: wrap;">
          <button 
            class="filter-btn" 
            :class="{ active: playerFilter === 'ALL' }"
            @click="playerFilter = 'ALL'; loadPlayersWithSubscription()">
            All Players
          </button>
          <button 
            class="filter-btn" 
            :class="{ active: playerFilter === 'SUBSCRIBED' }"
            @click="playerFilter = 'SUBSCRIBED'; loadPlayersWithSubscription()">
            Subscribed Only
          </button>
          <button 
            class="filter-btn" 
            :class="{ active: playerFilter === 'UNPAID' }"
            @click="playerFilter = 'UNPAID'; loadPlayersWithSubscription()">
            Unpaid / Pending
          </button>
          <button 
            class="filter-btn" 
            :class="{ active: playerFilter === 'ACTIVE_PAID' }"
            @click="playerFilter = 'ACTIVE_PAID'; loadPlayersWithSubscription()">
            Active & Paid
          </button>
        </div>
        
        <div v-if="loading" class="loading"><div class="spinner"></div></div>
        <div v-else-if="playersWithSubscription.length === 0" class="empty-state">
          <div class="empty-icon">üéÆ</div>
          <div>No players found</div>
        </div>
        <table v-else>
          <thead>
            <tr>
              <th>Username</th>
              <th>Name</th>
              <th>Email</th>
              <th>Registered</th>
              <th>Current Plan</th>
              <th>Subscription Status</th>
              <th>Payment Status</th>
              <th>Classes</th>
              <th>Used</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr 
              v-for="player in playersWithSubscription" 
              :key="player.playerId"
              :class="{
                'row-no-subscription': player.currentPlan === 'NONE',
                'row-unpaid': player.paymentStatus === 'UNPAID' || player.subscriptionStatus === 'PENDING_PAYMENT',
                'row-active-paid': player.subscriptionStatus === 'ACTIVE' && player.paymentStatus === 'PAID'
              }"
              @click="viewPlayerDetails(player.playerId)"
              style="cursor: pointer;">
              <td><strong>{{ player.username }}</strong></td>
              <td>{{ player.fullName }}</td>
              <td>{{ player.email }}</td>
              <td>{{ formatDate(player.registeredAt) }}</td>
              <td>
                <span v-if="player.currentPlan !== 'NONE'" class="badge" :class="{
                  'badge-basic': player.currentPlan === 'BASIC',
                  'badge-standard': player.currentPlan === 'STANDARD',
                  'badge-premium': player.currentPlan === 'PREMIUM'
                }">
                  {{ player.currentPlan }}
                </span>
                <span v-else class="badge badge-pending">None</span>
              </td>
              <td>
                <span class="badge" :class="{
                  'badge-active': player.subscriptionStatus === 'ACTIVE',
                  'badge-pending': player.subscriptionStatus === 'PENDING_PAYMENT' || player.subscriptionStatus === 'PENDING',
                  'status-approved': player.subscriptionStatus === 'CANCELLED' || player.subscriptionStatus === 'EXPIRED'
                }">
                  {{ player.subscriptionStatus }}
                </span>
              </td>
              <td>
                <span class="badge" :class="{
                  'badge-active': player.paymentStatus === 'PAID',
                  'badge-pending': player.paymentStatus === 'UNPAID',
                  'status-approved': player.paymentStatus === 'NONE'
                }">
                  {{ player.paymentStatus }}
                </span>
              </td>
              <td>{{ player.totalClasses }}</td>
              <td>{{ player.usedClasses }} / {{ player.totalClasses }}</td>
              <td @click.stop>
                <div class="action-buttons">
                  <button class="btn-sm btn-view" @click.stop="viewPlayerDetails(player.playerId)">üëÅÔ∏è View</button>
                  <button class="btn-sm btn-approve" @click.stop="editUser(player.userId)">‚úèÔ∏è Edit</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Parents Tab -->
      <div v-if="activeTab === 'parents'" class="table-container">
        <div class="table-header">
          <div class="table-title">üë®‚Äçüë©‚Äçüëß All Parents</div>
        </div>
        <div v-if="loading" class="loading"><div class="spinner"></div></div>
        <div v-else-if="parents.length === 0" class="empty-state">
          <div class="empty-icon">üë®‚Äçüë©‚Äçüëß</div>
          <div>No parents registered yet</div>
        </div>
        <table v-else>
          <thead>
            <tr>
              <th>Username</th>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Children</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="parent in parents" :key="parent.username">
              <td><strong>{{ parent.username }}</strong></td>
              <td>{{ parent.firstName }} {{ parent.lastName }}</td>
              <td>{{ parent.email }}</td>
              <td>{{ parent.phoneNumber || 'N/A' }}</td>
              <td>{{ parent.childrenCount || 0 }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Bookings Tab (Payments & Class Bookings) -->
      <div v-if="activeTab === 'bookings'" class="table-container">
        <div class="table-header">
          <div>
            <div class="table-title">üìÖ Payments & Class Bookings</div>
            <div class="table-subtitle">Complete flow: Subscription ‚Üí Payment ‚Üí Class Booking</div>
          </div>
        </div>
        <div v-if="loading" class="loading"><div class="spinner"></div></div>
        <div v-else-if="bookings.length === 0" class="empty-state">
          <div class="empty-icon">üìÖ</div>
          <div>No bookings found</div>
        </div>
        <table v-else>
          <thead>
            <tr>
              <th>Booking ID</th>
              <th>Player</th>
              <th>Username</th>
              <th>Email</th>
              <th>Subscription</th>
              <th>Package</th>
              <th>Price</th>
              <th>Class</th>
              <th>Game</th>
              <th>Session Date</th>
              <th>Time</th>
              <th>Booking Date</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="booking in bookings" :key="booking.bookingId">
              <td>{{ booking.bookingId }}</td>
              <td><strong>{{ booking.firstName }} {{ booking.lastName }}</strong></td>
              <td>{{ booking.username }}</td>
              <td>{{ booking.email }}</td>
              <td>#{{ booking.subscriptionId }}</td>
              <td>
                <span class="badge" :class="{
                  'badge-basic': booking.subscriptionPackage === 'BASIC',
                  'badge-standard': booking.subscriptionPackage === 'STANDARD',
                  'badge-premium': booking.subscriptionPackage === 'PREMIUM'
                }">
                  {{ booking.subscriptionPackage }}
                </span>
              </td>
              <td>{{ booking.subscriptionPrice }} SAR</td>
              <td>{{ booking.sessionName }}</td>
              <td>{{ booking.gameName }}</td>
              <td>{{ booking.sessionStartDate ? new Date(booking.sessionStartDate).toLocaleDateString() : 'N/A' }}</td>
              <td>{{ booking.sessionTime || 'N/A' }}</td>
              <td>{{ booking.bookDate ? new Date(booking.bookDate).toLocaleDateString() : 'N/A' }}</td>
              <td>
                <span class="badge" :class="{
                  'badge-active': booking.bookingStatus === 'ACTIVE',
                  'badge-pending': booking.bookingStatus === 'PENDING',
                  'status-approved': booking.bookingStatus === 'CANCELLED'
                }">
                  {{ booking.bookingStatus }}
                </span>
              </td>
              <td>
                <button 
                  v-if="booking.bookingStatus !== 'CANCELLED'"
                  class="btn-sm btn-reject" 
                  @click="cancelBookingAdmin(booking.bookingId)"
                  :disabled="processing">
                  Cancel
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Player Details Modal -->
    <div v-if="showPlayerDetailsModal" class="modal-overlay" @click.self="showPlayerDetailsModal = false">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">üë§ Player Details</div>
          <button class="modal-close" @click="showPlayerDetailsModal = false">√ó</button>
        </div>
        <div class="modal-body" v-if="selectedPlayerDetails">
          <!-- Basic Info -->
          <div class="modal-section">
            <div class="modal-section-title">üìã Basic Information</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
              <div><strong>Username:</strong> {{ selectedPlayerDetails.player.username }}</div>
              <div><strong>Full Name:</strong> {{ selectedPlayerDetails.player.fullName }}</div>
              <div><strong>Email:</strong> {{ selectedPlayerDetails.player.email }}</div>
              <div><strong>Registered:</strong> {{ formatDate(selectedPlayerDetails.player.registeredAt) }}</div>
              <div><strong>Status:</strong> 
                <span class="badge badge-active">{{ selectedPlayerDetails.player.status }}</span>
              </div>
            </div>
          </div>
          
          <!-- Subscriptions -->
          <div class="modal-section">
            <div class="modal-section-title">üí≥ Subscriptions</div>
            <div v-if="selectedPlayerDetails.subscriptions.length > 0">
              <table style="width: 100%; margin-top: 12px;">
                <thead>
                  <tr>
                    <th>Plan</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Start Date</th>
                    <th>End Date</th>
                    <th>Classes</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="sub in selectedPlayerDetails.subscriptions" :key="sub.subscriptionId">
                    <td>
                      <span class="badge" :class="{
                        'badge-basic': sub.plan === 'BASIC',
                        'badge-standard': sub.plan === 'STANDARD',
                        'badge-premium': sub.plan === 'PREMIUM'
                      }">{{ sub.plan }}</span>
                    </td>
                    <td>{{ sub.price }} {{ sub.currency }}</td>
                    <td>
                      <span class="badge" :class="{
                        'badge-active': sub.status === 'ACTIVE',
                        'badge-pending': sub.status === 'PENDING_PAYMENT'
                      }">{{ sub.status }}</span>
                    </td>
                    <td>{{ formatDate(sub.startDate) }}</td>
                    <td>{{ formatDate(sub.endDate) }}</td>
                    <td>{{ sub.classesCount }}</td>
                    <td>
                      <button 
                        v-if="sub.status === 'ACTIVE' || sub.status === 'PENDING_PAYMENT'"
                        class="btn-sm btn-reject" 
                        @click="cancelSubscription(sub.subscriptionId)"
                        :disabled="processing">
                        Cancel
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div v-else class="empty-state" style="padding: 20px;">No subscriptions</div>
          </div>
          
          <!-- Payments -->
          <div class="modal-section">
            <div class="modal-section-title">üí∞ Payments</div>
            <div v-if="selectedPlayerDetails.payments.length > 0">
              <table style="width: 100%; margin-top: 12px;">
                <thead>
                  <tr>
                    <th>Payment ID</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="payment in selectedPlayerDetails.payments" :key="payment.paymentId">
                    <td>#{{ payment.paymentId }}</td>
                    <td>{{ payment.amount }} {{ payment.currency }}</td>
                    <td>
                      <span class="badge" :class="{
                        'badge-active': payment.status === 'SUCCESS',
                        'badge-pending': payment.status === 'PENDING'
                      }">{{ payment.status }}</span>
                    </td>
                    <td>{{ formatDate(payment.paidAt) }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div v-else class="empty-state" style="padding: 20px;">No payments</div>
          </div>
          
          <!-- Bookings -->
          <div class="modal-section">
            <div class="modal-section-title">üìÖ Classes / Bookings</div>
            <div v-if="selectedPlayerDetails.bookings.length > 0">
              <table style="width: 100%; margin-top: 12px;">
                <thead>
                  <tr>
                    <th>Session ID</th>
                    <th>Date & Time</th>
                    <th>Trainer</th>
                    <th>Plan</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="booking in selectedPlayerDetails.bookings" :key="booking.bookingId">
                    <td>#{{ booking.sessionId }}</td>
                    <td>{{ formatDate(booking.sessionStartTime) }}</td>
                    <td>{{ booking.trainerName }}</td>
                    <td>{{ booking.plan }}</td>
                    <td>
                      <span class="badge" :class="{
                        'badge-active': booking.status === 'UPCOMING',
                        'status-approved': booking.status === 'COMPLETED',
                        'badge-pending': booking.status === 'CANCELLED'
                      }">{{ booking.status }}</span>
                    </td>
                    <td>
                      <button 
                        v-if="booking.status === 'UPCOMING'"
                        class="btn-sm btn-reject" 
                        @click="cancelBookingAdmin(booking.bookingId)"
                        :disabled="processing">
                        Cancel
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div v-else class="empty-state" style="padding: 20px;">No bookings</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit User Modal -->
    <div v-if="showEditUserModal" class="modal-overlay" @click.self="showEditUserModal = false">
      <div class="modal" style="max-width: 500px;">
        <div class="modal-header">
          <div class="modal-title">‚úèÔ∏è Edit User</div>
          <button class="modal-close" @click="showEditUserModal = false">√ó</button>
        </div>
        <div class="modal-body">
          <div style="display: flex; flex-direction: column; gap: 16px;">
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600;">First Name</label>
              <input 
                type="text" 
                v-model="editForm.firstName" 
                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: var(--text);"
                placeholder="First Name">
            </div>
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600;">Last Name</label>
              <input 
                type="text" 
                v-model="editForm.lastName" 
                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: var(--text);"
                placeholder="Last Name">
            </div>
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600;">Username</label>
              <input 
                type="text" 
                v-model="editForm.username" 
                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: var(--text);"
                placeholder="Username">
            </div>
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600;">Email</label>
              <input 
                type="email" 
                v-model="editForm.email" 
                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: var(--text);"
                placeholder="Email">
            </div>
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600;">Role</label>
              <select 
                v-model="editForm.role" 
                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: var(--text);">
                <option value="PLAYER">PLAYER</option>
                <option value="PRO">PRO</option>
                <option value="TRAINER">TRAINER</option>
                <option value="PARENTS">PARENTS</option>
                <option value="MODERATOR">MODERATOR</option>
                <option value="ADMIN">ADMIN</option>
              </select>
            </div>
            <div style="display: flex; gap: 12px; margin-top: 8px;">
              <button 
                class="btn-sm btn-approve" 
                @click="saveUser"
                :disabled="processing"
                style="flex: 1;">
                Save Changes
              </button>
              <button 
                class="btn-sm btn-reject" 
                @click="showEditUserModal = false"
                style="flex: 1;">
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" :class="[toast.type, { show: toast.show }]">
      <span class="toast-icon">{{ toast.type === 'success' ? '‚úì' : '‚úó' }}</span>
      <span>{{ toast.message }}</span>
    </div>
  </div>

  <script src="config.js"></script>
  <script>
    const { createApp, ref, reactive, computed, onMounted } = Vue;

    createApp({
      setup() {
        const activeTab = ref('pending');
        const loading = ref(false);
        const processing = ref(false);
        const userName = ref('Admin');
        
        const pros = ref([]);
        const trainers = ref([]);
        const players = ref([]);
        const parents = ref([]);
        const subscriptions = ref([]);
        const bookings = ref([]);
        const playersWithSubscription = ref([]);
        const playerFilter = ref('ALL');
        const overviewStats = ref(null);
        const selectedPlayerDetails = ref(null);
        const showPlayerDetailsModal = ref(false);
        const showEditUserModal = ref(false);
        const editingUser = ref(null);
        const editForm = reactive({
          userId: null,
          firstName: '',
          lastName: '',
          username: '',
          email: '',
          role: '',
          status: 'ACTIVE'
        });
        
        const toast = reactive({
          show: false,
          message: '',
          type: 'success'
        });

        const token = localStorage.getItem('authToken');
        const tokenType = localStorage.getItem('tokenType') || 'Bearer';
        const storedUserName = localStorage.getItem('userName');

        if (storedUserName) {
          userName.value = storedUserName;
        }

        // Computed stats
        const stats = computed(() => ({
          pendingPros: (pros.value || []).filter(p => !p.isApproved).length,
          approvedPros: (pros.value || []).filter(p => p.isApproved).length,
          pendingTrainers: (trainers.value || []).filter(t => !t.isApproved).length,
          approvedTrainers: (trainers.value || []).filter(t => t.isApproved).length,
          totalPlayers: (players.value || []).length,
          totalParents: (parents.value || []).length,
          totalSubscriptions: subscriptions.value.length,
          totalBookings: bookings.value.length,
          activeBookings: bookings.value.filter(b => b.bookingStatus === 'ACTIVE').length,
          pendingBookings: bookings.value.filter(b => b.bookingStatus === 'PENDING').length
        }));

        const pendingPros = computed(() => pros.value.filter(p => !p.isApproved));
        const pendingTrainers = computed(() => trainers.value.filter(t => !t.isApproved));

        // Check auth
        onMounted(() => {
          const userRole = localStorage.getItem('userRole');
          
          if (!token || userRole !== 'ADMIN') {
            window.location.href = 'login.html';
            return;
          }
          
          loadData();
        });

        const apiCall = async (endpoint, options = {}) => {
          const url = window.apiUrl ? window.apiUrl(endpoint) : endpoint;
          const response = await fetch(url, {
            ...options,
            headers: {
              ...options.headers,
              'Authorization': `${tokenType} ${token}`
            }
          });
          
          if (!response.ok) {
            if (response.status === 401 || response.status === 403) {
              showToast('Session expired. Please login again.', 'error');
              setTimeout(() => {
                localStorage.clear();
                window.location.href = 'login.html';
              }, 2000);
              throw new Error('Unauthorized');
            }
            throw new Error(await response.text());
          }
          return response.json();
        };

        const loadData = async () => {
          loading.value = true;
          try {
            // Load all data in parallel
            const [prosData, trainersData, playersData, parentsData, subscriptionsData, bookingsData, statsData] = await Promise.all([
              apiCall('/api/v1/pro/get').catch(() => []),
              apiCall('/api/v1/trainer/get').catch(() => []),
              apiCall('/api/v1/player/get').catch(() => []),
              apiCall('/api/v1/parent/get').catch(() => []),
              apiCall('/api/v1/user/get-all-subscriptions-with-users').catch(() => []),
              apiCall('/api/v1/booking/admin/get-all').catch(() => []),
              apiCall('/api/v1/admin/stats/overview').catch(() => null)
            ]);
            
            pros.value = prosData;
            trainers.value = trainersData;
            players.value = playersData;
            parents.value = parentsData;
            subscriptions.value = subscriptionsData;
            bookings.value = bookingsData;
            overviewStats.value = statsData;
            
            // Load players with subscription info
            await loadPlayersWithSubscription();
          } catch (error) {
            console.error('Error loading data:', error);
            if (error.message !== 'Unauthorized') {
              showToast('Failed to load data', 'error');
            }
          } finally {
            loading.value = false;
          }
        };
        
        const loadPlayersWithSubscription = async () => {
          try {
            console.log('Loading players with subscription, filter:', playerFilter.value);
            const data = await apiCall(`/api/v1/admin/players?status=${playerFilter.value}`);
            console.log('Players with subscription data:', data);
            playersWithSubscription.value = data || [];
            if (playersWithSubscription.value.length === 0) {
              console.warn('No players returned from API');
            }
          } catch (error) {
            console.error('Error loading players with subscription:', error);
            showToast('Failed to load players data', 'error');
            playersWithSubscription.value = [];
          }
        };
        
        const viewPlayerDetails = async (playerId) => {
          try {
            const details = await apiCall(`/api/v1/admin/players/${playerId}/details`);
            selectedPlayerDetails.value = details;
            showPlayerDetailsModal.value = true;
          } catch (error) {
            console.error('Error loading player details:', error);
            showToast('Failed to load player details', 'error');
          }
        };
        
        const editUser = async (user) => {
          try {
            // Accept user object directly or find by ID
            let targetUser = user;
            if (typeof user === 'number' || typeof user === 'string') {
              const userId = parseInt(user);
              targetUser = playersWithSubscription.value.find(p => p.userId === userId) ||
                          players.value.find(p => p.id === userId) ||
                          pros.value.find(p => p.user?.id === userId) ||
                          trainers.value.find(t => t.user?.id === userId) ||
                          parents.value.find(p => p.user?.id === userId || p.id === userId);
            }
            
            if (targetUser) {
              editingUser.value = targetUser;
              const userId = targetUser.userId || targetUser.id || targetUser.user?.id;
              editForm.userId = userId;
              editForm.firstName = targetUser.firstName || targetUser.user?.firstName || '';
              editForm.lastName = targetUser.lastName || targetUser.user?.lastName || '';
              editForm.username = targetUser.username || targetUser.user?.username || '';
              editForm.email = targetUser.email || targetUser.user?.email || '';
              editForm.role = targetUser.role || targetUser.user?.role || '';
              editForm.status = targetUser.status || targetUser.user?.status || 'ACTIVE';
              showEditUserModal.value = true;
            }
          } catch (error) {
            console.error('Error loading user for edit:', error);
            showToast('Failed to load user information', 'error');
          }
        };
        
        const saveUser = async () => {
          if (!editForm.userId) {
            showToast('Invalid user ID', 'error');
            return;
          }
          
          processing.value = true;
          try {
            const payload = {
              firstName: editForm.firstName,
              lastName: editForm.lastName,
              email: editForm.email,
              role: editForm.role,
              status: editForm.status
            };
            
            await apiCall(`/api/v1/admin/users/${editForm.userId}`, {
              method: 'PATCH',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
            
            showToast('User updated successfully', 'success');
            showEditUserModal.value = false;
            editingUser.value = null;
            // Reset form
            editForm.userId = null;
            editForm.firstName = '';
            editForm.lastName = '';
            editForm.username = '';
            editForm.email = '';
            editForm.role = '';
            editForm.status = 'ACTIVE';
            await loadData();
            await loadPlayersWithSubscription();
          } catch (error) {
            console.error('Error updating user:', error);
            showToast('Failed to update user: ' + (error.message || 'Unknown error'), 'error');
          } finally {
            processing.value = false;
          }
        };
        
        const deleteUser = async (userId) => {
          if (!confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
            return;
          }
          
          processing.value = true;
          try {
            await apiCall(`/api/v1/admin/users/${userId}`, { method: 'DELETE' });
            showToast('User deleted successfully', 'success');
            await loadData();
            await loadPlayersWithSubscription();
          } catch (error) {
            console.error('Error deleting user:', error);
            showToast('Failed to delete user: ' + (error.message || 'Unknown error'), 'error');
          } finally {
            processing.value = false;
          }
        };
        
        const cancelBookingAdmin = async (bookingId) => {
          if (!confirm('Are you sure you want to cancel this booking?')) {
            return;
          }
          
          processing.value = true;
          try {
            await apiCall(`/api/v1/admin/bookings/${bookingId}`, { method: 'DELETE' });
            showToast('Booking cancelled successfully', 'success');
            await loadData();
            if (selectedPlayerDetails.value) {
              await viewPlayerDetails(selectedPlayerDetails.value.player.playerId);
            }
          } catch (error) {
            console.error('Error cancelling booking:', error);
            showToast('Failed to cancel booking: ' + (error.message || 'Unknown error'), 'error');
          } finally {
            processing.value = false;
          }
        };
        
        const cancelSubscription = async (subscriptionId) => {
          if (!confirm('Are you sure you want to cancel this subscription?')) {
            return;
          }
          
          processing.value = true;
          try {
            await apiCall(`/api/v1/admin/subscriptions/${subscriptionId}`, {
              method: 'PATCH',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ status: 'CANCELLED' })
            });
            showToast('Subscription cancelled successfully', 'success');
            if (selectedPlayerDetails.value) {
              await viewPlayerDetails(selectedPlayerDetails.value.player.playerId);
            }
            await loadData();
            await loadPlayersWithSubscription();
          } catch (error) {
            console.error('Error cancelling subscription:', error);
            showToast('Failed to cancel subscription: ' + (error.message || 'Unknown error'), 'error');
          } finally {
            processing.value = false;
          }
        };
        
        const formatDate = (date) => {
          if (!date) return 'N/A';
          const d = new Date(date);
          return d.toLocaleDateString();
        };

        const approvePro = async (proId) => {
          if (!confirm('Approve this pro player? They will receive an email and can login.')) return;
          processing.value = true;
          try {
            await apiCall(`/api/v1/pro/approve/${proId}`, { method: 'POST' });
            showToast('‚úì Pro player approved successfully!', 'success');
            await loadData();
          } catch (error) {
            showToast('Failed to approve pro player', 'error');
          } finally {
            processing.value = false;
          }
        };

        const rejectPro = async (proId) => {
          if (!confirm('Reject and delete this pro player application? This cannot be undone.')) return;
          processing.value = true;
          try {
            await apiCall(`/api/v1/pro/reject/${proId}`, { method: 'PUT' });
            showToast('Pro player application rejected', 'success');
            await loadData();
          } catch (error) {
            showToast('Failed to reject pro player', 'error');
          } finally {
            processing.value = false;
          }
        };

        const approveTrainer = async (trainerId) => {
          if (!confirm('Approve this trainer? They will receive an email and can login.')) return;
          processing.value = true;
          try {
            await apiCall(`/api/v1/trainer/approve-trainer/${trainerId}`, { method: 'POST' });
            showToast('‚úì Trainer approved successfully!', 'success');
            await loadData();
          } catch (error) {
            showToast('Failed to approve trainer', 'error');
          } finally {
            processing.value = false;
          }
        };

        const rejectTrainer = async (trainerId) => {
          if (!confirm('Reject and delete this trainer application? This cannot be undone.')) return;
          processing.value = true;
          try {
            await apiCall(`/api/v1/trainer/reject-trainer/${trainerId}`, { method: 'PUT' });
            showToast('Trainer application rejected', 'success');
            await loadData();
          } catch (error) {
            showToast('Failed to reject trainer', 'error');
          } finally {
            processing.value = false;
          }
        };

        const downloadCV = async (type, id) => {
          try {
            const endpoint = type === 'pro' ? `/api/v1/pro/cv/${id}` : `/api/v1/trainer/cv/${id}`;
            const url = window.apiUrl ? window.apiUrl(endpoint) : endpoint;
            
            const response = await fetch(url, {
              headers: { 'Authorization': `${tokenType} ${token}` }
            });
            
            if (!response.ok) throw new Error('Failed to download CV');
            
            const blob = await response.blob();
            const downloadUrl = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = downloadUrl;
            a.download = `${type}_cv_${id}.pdf`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(downloadUrl);
            document.body.removeChild(a);
            showToast('CV downloaded successfully', 'success');
          } catch (error) {
            showToast('Failed to download CV', 'error');
          }
        };

        const showToast = (message, type = 'success') => {
          toast.message = message;
          toast.type = type;
          toast.show = true;
          setTimeout(() => {
            toast.show = false;
          }, 3500);
        };

        const logout = () => {
          localStorage.clear();
          window.location.href = 'login.html';
        };

        return {
          activeTab,
          loading,
          processing,
          userName,
          pros,
          trainers,
          players,
          parents,
          subscriptions,
          bookings,
          playersWithSubscription,
          playerFilter,
          overviewStats,
          selectedPlayerDetails,
          showPlayerDetailsModal,
          showEditUserModal,
          editingUser,
          editForm,
          stats,
          pendingPros,
          pendingTrainers,
          toast,
          approvePro,
          rejectPro,
          approveTrainer,
          rejectTrainer,
          downloadCV,
          loadPlayersWithSubscription,
          viewPlayerDetails,
          editUser,
          saveUser,
          deleteUser,
          cancelBookingAdmin,
          cancelSubscription,
          formatDate,
          logout
        };
      }
    }).mount('#app');
  </script>
  
<!-- Footer -->
  <footer class="lu-footer">
    <div class="lu-footer-inner">
      <a href="home.html" class="lu-footer-logo-link">
        <img src="/assets/logo/logo.png" alt="LevelUp Academy" class="lu-footer-logo-img" style="height: 18px !important; width: auto !important; max-width: 100px !important; display: block !important;" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
        <span style="display:none; font-size: 18px; font-weight: 700; background: var(--lu-gradient-brand); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">üéÆ LevelUp Academy</span>
      </a>
      <p class="lu-footer-text">¬© 2024 LevelUp Academy. All rights reserved.</p>
    </div>
  </footer>

</body>
</html>

